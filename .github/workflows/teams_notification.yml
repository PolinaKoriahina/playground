name: Send Teams notification

on: [workflow_dispatch]

jobs:
  send_notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2   
        
      - name: Run Python script
        id: message 
        run: |
          file_name = "raw_data_dc3078d8-ee29-4411-b4ef-fa0f0f0203f2.json"
          output=$(python -c "from extracts_status import form_message; form_message($file_name))
          echo "script_output=$output" >> $GITHUB_OUTPUT
          echo $output
      
      - name: Send Teams notification
        env:
          TEAMS_WEBHOOK_URL: ${{ secrets.TEAMS_WEBHOOK_URL }}
        run: |
         curl -H "Content-Type: application/json" -d '${{ steps.message.outputs.script_output }}' $TEAMS_WEBHOOK_URL
